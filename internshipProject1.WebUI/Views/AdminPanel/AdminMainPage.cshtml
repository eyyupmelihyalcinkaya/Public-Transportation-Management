@{
    ViewData["Title"] = "Admin Panel";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <!-- Page Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1 class="h3 mb-0">
                        <i class="fas fa-tachometer-alt text-primary"></i> Admin Panel
                    </h1>
                    <p class="text-muted mb-0">Manage your transportation system</p>
                </div>
                <div class="d-flex gap-2">
                    <button class="btn btn-outline-secondary btn-sm" onclick="refreshAllData()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                    <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#settingsModal">
                        <i class="fas fa-cog"></i> Settings
                    </button>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="row mb-4">
                <div class="col-xl-3 col-md-6 mb-3">
                    <div class="card bg-primary text-white h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <div class="h5 mb-0" id="totalRoutes">12</div>
                                    <div class="small">Total Routes</div>
                                </div>
                                <div class="fa-2x">
                                    <i class="fas fa-route"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 mb-3">
                    <div class="card bg-success text-white h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <div class="h5 mb-0" id="totalStops">48</div>
                                    <div class="small">Total Stops</div>
                                </div>
                                <div class="fa-2x">
                                    <i class="fas fa-map-marker-alt"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 mb-3">
                    <div class="card bg-info text-white h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <div class="h5 mb-0" id="totalTrips">156</div>
                                    <div class="small">Total Trips</div>
                                </div>
                                <div class="fa-2x">
                                    <i class="fas fa-bus"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 mb-3">
                    <div class="card bg-warning text-white h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <div class="h5 mb-0" id="totalConnections">89</div>
                                    <div class="small">Route Connections</div>
                                </div>
                                <div class="fa-2x">
                                    <i class="fas fa-link"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Tabs -->
            <ul class="nav nav-tabs nav-fill" id="adminTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="routes-tab" data-bs-toggle="tab" data-bs-target="#routes" type="button" role="tab">
                        <i class="fas fa-route"></i> Routes
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="stops-tab" data-bs-toggle="tab" data-bs-target="#stops" type="button" role="tab">
                        <i class="fas fa-map-marker-alt"></i> Stops
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="trips-tab" data-bs-toggle="tab" data-bs-target="#trips" type="button" role="tab">
                        <i class="fas fa-bus"></i> Trips
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="routestops-tab" data-bs-toggle="tab" data-bs-target="#routestops" type="button" role="tab">
                        <i class="fas fa-link"></i> Route Stops
                    </button>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content" id="adminTabsContent">
                <!-- Routes Tab -->
                <div class="tab-pane fade show active" id="routes" role="tabpanel">
                    <div class="card mt-3">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <i class="fas fa-route text-primary"></i> Routes Management
                            </h5>
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addRouteModal">
                                <i class="fas fa-plus"></i> Add Route
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Description</th>
                                            <th>Start Location</th>
                                            <th>End Location</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="routesTableBody">
                                        <!-- Sample Data -->
                                        <tr>
                                            <td>1</td>
                                            <td><span class="badge bg-primary">Route A</span></td>
                                            <td>Main city route</td>
                                            <td>Central Station</td>
                                            <td>Airport</td>
                                            <td>
                                                <div class="btn-group btn-group-sm">
                                                    <button class="btn btn-outline-info" onclick="editRoute(1)">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-outline-danger" onclick="deleteRoute(1)">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>2</td>
                                            <td><span class="badge bg-success">Route B</span></td>
                                            <td>Suburban route</td>
                                            <td>Downtown</td>
                                            <td>Mall</td>
                                            <td>
                                                <div class="btn-group btn-group-sm">
                                                    <button class="btn btn-outline-info" onclick="editRoute(2)">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-outline-danger" onclick="deleteRoute(2)">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stops Tab -->
                <div class="tab-pane fade" id="stops" role="tabpanel">
                    <div class="card mt-3">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <i class="fas fa-map-marker-alt text-success"></i> Stops Management
                            </h5>
                            <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addStopModal">
                                <i class="fas fa-plus"></i> Add Stop
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Latitude</th>
                                            <th>Longitude</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="stopsTableBody">
                                        <!-- Sample Data -->
                                        <tr>
                                            <td>1</td>
                                            <td><i class="fas fa-map-pin text-danger"></i> Central Station</td>
                                            <td>40.7128</td>
                                            <td>-74.0060</td>
                                            <td>
                                                <div class="btn-group btn-group-sm">
                                                    <button class="btn btn-outline-info" onclick="editStop(1)">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-outline-danger" onclick="deleteStop(1)">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>2</td>
                                            <td><i class="fas fa-map-pin text-danger"></i> Airport Terminal</td>
                                            <td>40.6892</td>
                                            <td>-74.1745</td>
                                            <td>
                                                <div class="btn-group btn-group-sm">
                                                    <button class="btn btn-outline-info" onclick="editStop(2)">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-outline-danger" onclick="deleteStop(2)">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Trips Tab -->
                <div class="tab-pane fade" id="trips" role="tabpanel">
                    <div class="card mt-3">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <i class="fas fa-bus text-info"></i> Trips Management
                            </h5>
                            <button class="btn btn-info" data-bs-toggle="modal" data-bs-target="#addTripModal">
                                <i class="fas fa-plus"></i> Add Trip
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>ID</th>
                                            <th>Route</th>
                                            <th>Start Time</th>
                                            <th>End Time</th>
                                            <th>Day Type</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tripsTableBody">
                                        <!-- Sample Data -->
                                        <tr>
                                            <td>1</td>
                                            <td><span class="badge bg-primary">Route A</span></td>
                                            <td>08:00</td>
                                            <td>09:30</td>
                                            <td><span class="badge bg-success">Weekday</span></td>
                                            <td>
                                                <div class="btn-group btn-group-sm">
                                                    <button class="btn btn-outline-info" onclick="editTrip(1)">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-outline-danger" onclick="deleteTrip(1)">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>2</td>
                                            <td><span class="badge bg-success">Route B</span></td>
                                            <td>09:15</td>
                                            <td>10:45</td>
                                            <td><span class="badge bg-warning">Weekend</span></td>
                                            <td>
                                                <div class="btn-group btn-group-sm">
                                                    <button class="btn btn-outline-info" onclick="editTrip(2)">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-outline-danger" onclick="deleteTrip(2)">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Route Stops Tab -->
                <div class="tab-pane fade" id="routestops" role="tabpanel">
                    <div class="card mt-3">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <i class="fas fa-link text-warning"></i> Route Stops Management
                            </h5>
                            <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#addRouteStopModal">
                                <i class="fas fa-plus"></i> Add Route Stop
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>ID</th>
                                            <th>Route</th>
                                            <th>Stop</th>
                                            <th>Order</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="routeStopsTableBody">
                                        <!-- Sample Data -->
                                        <tr>
                                            <td>1</td>
                                            <td><span class="badge bg-primary">Route A</span></td>
                                            <td><i class="fas fa-map-pin text-danger"></i> Central Station</td>
                                            <td><span class="badge bg-secondary">1</span></td>
                                            <td>
                                                <div class="btn-group btn-group-sm">
                                                    <button class="btn btn-outline-info" onclick="editRouteStop(1)">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-outline-danger" onclick="deleteRouteStop(1)">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>2</td>
                                            <td><span class="badge bg-primary">Route A</span></td>
                                            <td><i class="fas fa-map-pin text-danger"></i> Airport Terminal</td>
                                            <td><span class="badge bg-secondary">2</span></td>
                                            <td>
                                                <div class="btn-group btn-group-sm">
                                                    <button class="btn btn-outline-info" onclick="editRouteStop(2)">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-outline-danger" onclick="deleteRouteStop(2)">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Modals {
<!-- Add Route Modal -->
<div class="modal fade" id="addRouteModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">
                    <i class="fas fa-plus"></i> Add New Route
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addRouteForm">
                    <div class="mb-3">
                        <label for="routeName" class="form-label">Route Name *</label>
                        <input type="text" class="form-control" id="routeName" required>
                    </div>
                    <div class="mb-3">
                        <label for="routeDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="routeDescription" rows="3"></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="startLocation" class="form-label">Start Location *</label>
                                <input type="text" class="form-control" id="startLocation" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="endLocation" class="form-label">End Location *</label>
                                <input type="text" class="form-control" id="endLocation" required>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button type="button" class="btn btn-primary" onclick="saveRoute()">
                    <i class="fas fa-save"></i> Save Route
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Add Stop Modal -->
<div class="modal fade" id="addStopModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">
                    <i class="fas fa-plus"></i> Add New Stop
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addStopForm">
                    <div class="mb-3">
                        <label for="stopName" class="form-label">Stop Name *</label>
                        <input type="text" class="form-control" id="stopName" required>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="stopLatitude" class="form-label">Latitude *</label>
                                <input type="number" class="form-control" id="stopLatitude" step="0.000001" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="stopLongitude" class="form-label">Longitude *</label>
                                <input type="number" class="form-control" id="stopLongitude" step="0.000001" required>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button type="button" class="btn btn-success" onclick="saveStop()">
                    <i class="fas fa-save"></i> Save Stop
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Add Trip Modal -->
<div class="modal fade" id="addTripModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title">
                    <i class="fas fa-plus"></i> Add New Trip
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addTripForm">
                    <div class="mb-3">
                        <label for="tripRoute" class="form-label">Route *</label>
                        <select class="form-select" id="tripRoute" required>
                            <option value="">Select a route</option>
                            <option value="1">Route A</option>
                            <option value="2">Route B</option>
                        </select>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="startTime" class="form-label">Start Time *</label>
                                <input type="time" class="form-control" id="startTime" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="endTime" class="form-label">End Time *</label>
                                <input type="time" class="form-control" id="endTime" required>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="dayType" class="form-label">Day Type *</label>
                        <select class="form-select" id="dayType" required>
                            <option value="">Select day type</option>
                            <option value="weekday">Weekday</option>
                            <option value="saturday">Saturday</option>
                            <option value="sunday">Sunday</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button type="button" class="btn btn-info" onclick="saveTrip()">
                    <i class="fas fa-save"></i> Save Trip
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Add Route Stop Modal -->
<div class="modal fade" id="addRouteStopModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title">
                    <i class="fas fa-plus"></i> Add Route Stop Connection
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addRouteStopForm">
                    <div class="mb-3">
                        <label for="routeStopRoute" class="form-label">Route *</label>
                        <select class="form-select" id="routeStopRoute" required>
                            <option value="">Select a route</option>
                            <option value="1">Route A</option>
                            <option value="2">Route B</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="routeStopStop" class="form-label">Stop *</label>
                        <select class="form-select" id="routeStopStop" required>
                            <option value="">Select a stop</option>
                            <option value="1">Central Station</option>
                            <option value="2">Airport Terminal</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="stopOrder" class="form-label">Order *</label>
                        <input type="number" class="form-control" id="stopOrder" min="1" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button type="button" class="btn btn-warning" onclick="saveRouteStop()">
                    <i class="fas fa-save"></i> Save Connection
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Settings Modal -->
<div class="modal fade" id="settingsModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-cog"></i> Settings
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <h6>Theme Settings</h6>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="theme" id="lightTheme" value="light">
                        <label class="form-check-label" for="lightTheme">Light Theme</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="theme" id="darkTheme" value="dark">
                        <label class="form-check-label" for="darkTheme">Dark Theme</label>
                    </div>
                </div>
                <div class="mb-3">
                    <h6>Auto Refresh</h6>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="autoRefresh">
                        <label class="form-check-label" for="autoRefresh">Enable auto refresh (30s)</label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
            </div>
        </div>
    </div>
</div>
}

<!-- Toast Container -->
<div class="toast-container position-fixed bottom-0 end-0 p-3" id="toastContainer"></div>

@section Scripts {
    <script>
        // Admin Panel JavaScript Functions
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadInitialData();
            
            // Theme ayarlarını yükle
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.classList.remove('light', 'dark');
            document.body.classList.add(savedTheme);
            
            // Settings modal'daki theme radio button'larını güncelle
            if (savedTheme === 'dark') {
                document.getElementById('darkTheme').checked = true;
            } else {
                document.getElementById('lightTheme').checked = true;
            }
            
            // Auto refresh ayarlarını yükle
            const autoRefresh = localStorage.getItem('autoRefresh') === 'true';
            if (autoRefresh) {
                document.getElementById('autoRefresh').checked = true;
            }
        });
        
        // Load initial data from backend APIs
        async function loadInitialData() {
            console.log('Loading initial data from backend...');
            try {
                // Load all data in parallel
                await Promise.all([
                    loadRoutes(),
                    loadStops(),
                    loadTrips(),
                    loadStats()
                ]);
                console.log('Initial data loaded successfully');
            } catch (error) {
                console.error('Error loading initial data:', error);
                showToast('Failed to load some data. Please refresh the page.', 'error');
            }
        }
        
        // Load basic stats
        async function loadStats() {
            try {
                // Routes count
                const routesResponse = await fetch('https://localhost:7009/api/Routes');
                if (routesResponse.ok) {
                    const routes = await routesResponse.json();
                    document.getElementById('totalRoutes').textContent = routes.length || 0;
                }
                
                // Stops count  
                const stopsResponse = await fetch('https://localhost:7009/api/Stops');
                if (stopsResponse.ok) {
                    const stops = await stopsResponse.json();
                    document.getElementById('totalStops').textContent = stops.length || 0;
                }
                
                // Trips count
                const tripsResponse = await fetch('https://localhost:7009/api/Trips');
                if (tripsResponse.ok) {
                    const trips = await tripsResponse.json();
                    document.getElementById('totalTrips').textContent = trips.length || 0;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }
        
        // Refresh all data
        function refreshAllData() {
            showToast('Refreshing data...', 'info');
            // API calls to refresh all data
            setTimeout(() => {
                showToast('Data refreshed successfully!', 'success');
            }, 1000);
        }
        
        // Route Functions
        async function saveRoute() {
            const routeName = document.getElementById('routeName').value;
            const routeDescription = document.getElementById('routeDescription').value;
            const startLocation = document.getElementById('startLocation').value;
            const endLocation = document.getElementById('endLocation').value;
            
            if (!routeName || !startLocation || !endLocation) {
                showToast('Please fill in all required fields!', 'error');
                return;
            }
            
            try {
                showToast('Creating route...', 'info');
                
                // Backend API'ye POST isteği gönder
                const response = await fetch('https://localhost:7009/api/Routes', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        // Authorization header eklenebilir (JWT token için)
                        // 'Authorization': `Bearer ${getToken()}`
                    },
                    body: JSON.stringify({
                        Name: routeName,
                        Description: routeDescription,
                        StartLocation: startLocation,
                        EndLocation: endLocation
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('Route created:', result);
                    
                    // Close modal
                    bootstrap.Modal.getInstance(document.getElementById('addRouteModal')).hide();
                    
                    // Clear form
                    document.getElementById('addRouteForm').reset();
                    
                    // Show success message
                    showToast(`Route "${result.Name}" created successfully!`, 'success');
                    
                    // Refresh routes data
                    loadRoutes();
                } else {
                    const errorText = await response.text();
                    console.error('Route creation failed:', errorText);
                    showToast(`Failed to create route: ${response.status}`, 'error');
                }
            } catch (error) {
                console.error('Error creating route:', error);
                showToast('Connection error. Please try again.', 'error');
            }
        }
        
        // Load routes from backend
        async function loadRoutes() {
            try {
                const response = await fetch('https://localhost:7009/api/Routes');
                if (response.ok) {
                    const routes = await response.json();
                    updateRoutesTable(routes);
                } else {
                    console.error('Failed to load routes:', response.status);
                    showToast('Failed to load routes', 'error');
                }
            } catch (error) {
                console.error('Error loading routes:', error);
                showToast('Connection error while loading routes', 'error');
            }
        }
        
        // Update routes table with data
        function updateRoutesTable(routes) {
            const tbody = document.getElementById('routesTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            routes.forEach(route => {
                const row = `
                    <tr>
                        <td>${route.id}</td>
                        <td><span class="badge bg-primary">${route.name}</span></td>
                        <td>${route.description || '-'}</td>
                        <td>${route.startLocation || '-'}</td>
                        <td>${route.endLocation || '-'}</td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-info" onclick="editRoute(${route.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline-danger" onclick="deleteRoute(${route.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function editRoute(id) {
            showToast('Edit route functionality will be implemented!', 'info');
            // API call to get route data and populate edit modal
        }
        
        async function deleteRoute(id) {
            if (confirm('Are you sure you want to delete this route?')) {
                try {
                    showToast('Deleting route...', 'info');
                    
                    const response = await fetch(`https://localhost:7009/api/Routes/${id}`, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                            // Authorization header eklenebilir (JWT token için)
                            // 'Authorization': `Bearer ${getToken()}`
                        }
                    });
                    
                    if (response.ok) {
                        showToast('Route deleted successfully!', 'success');
                        loadRoutes(); // Refresh routes list
                    } else {
                        const errorText = await response.text();
                        console.error('Route deletion failed:', errorText);
                        showToast(`Failed to delete route: ${response.status}`, 'error');
                    }
                } catch (error) {
                    console.error('Error deleting route:', error);
                    showToast('Connection error while deleting route', 'error');
                }
            }
        }
        
        // Stop Functions
        async function saveStop() {
            const stopName = document.getElementById('stopName').value;
            const stopLatitude = parseFloat(document.getElementById('stopLatitude').value);
            const stopLongitude = parseFloat(document.getElementById('stopLongitude').value);
            
            if (!stopName || isNaN(stopLatitude) || isNaN(stopLongitude)) {
                showToast('Please fill in all required fields with valid values!', 'error');
                return;
            }
            
            try {
                showToast('Creating stop...', 'info');
                
                // Backend API'ye POST isteği gönder
                const response = await fetch('https://localhost:7009/api/Stops', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        // Authorization header eklenebilir (JWT token için)
                        // 'Authorization': `Bearer ${getToken()}`
                    },
                    body: JSON.stringify({
                        Name: stopName,
                        Latitude: stopLatitude,
                        Longitude: stopLongitude
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('Stop created:', result);
                    
                    // Close modal
                    bootstrap.Modal.getInstance(document.getElementById('addStopModal')).hide();
                    
                    // Clear form
                    document.getElementById('addStopForm').reset();
                    
                    // Show success message
                    showToast(`Stop "${result.Name}" created successfully!`, 'success');
                    
                    // Refresh stops data
                    loadStops();
                } else {
                    const errorText = await response.text();
                    console.error('Stop creation failed:', errorText);
                    showToast(`Failed to create stop: ${response.status}`, 'error');
                }
            } catch (error) {
                console.error('Error creating stop:', error);
                showToast('Connection error. Please try again.', 'error');
            }
        }
        
        // Load stops from backend
        async function loadStops() {
            try {
                const response = await fetch('https://localhost:7009/api/Stops');
                if (response.ok) {
                    const stops = await response.json();
                    updateStopsTable(stops);
                } else {
                    console.error('Failed to load stops:', response.status);
                    showToast('Failed to load stops', 'error');
                }
            } catch (error) {
                console.error('Error loading stops:', error);
                showToast('Connection error while loading stops', 'error');
            }
        }
        
        // Update stops table with data
        function updateStopsTable(stops) {
            const tbody = document.getElementById('stopsTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            stops.forEach(stop => {
                const row = `
                    <tr>
                        <td>${stop.id}</td>
                        <td><span class="badge bg-success">${stop.name}</span></td>
                        <td>${stop.latitude.toFixed(6)}</td>
                        <td>${stop.longitude.toFixed(6)}</td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-info" onclick="editStop(${stop.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline-danger" onclick="deleteStop(${stop.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function editStop(id) {
            showToast('Edit stop functionality will be implemented!', 'info');
        }
        
        function deleteStop(id) {
            if (confirm('Are you sure you want to delete this stop?')) {
                showToast('Stop deleted successfully!', 'success');
            }
        }
        
        // Trip Functions
        
        // Load trips from backend
        async function loadTrips() {
            try {
                const response = await fetch('https://localhost:7009/api/Trips');
                if (response.ok) {
                    const trips = await response.json();
                    updateTripsTable(trips);
                } else {
                    console.error('Failed to load trips:', response.status);
                    showToast('Failed to load trips', 'error');
                }
            } catch (error) {
                console.error('Error loading trips:', error);
                showToast('Connection error while loading trips', 'error');
            }
        }
        
        // Update trips table with data
        function updateTripsTable(trips) {
            const tbody = document.getElementById('tripsTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            trips.forEach(trip => {
                const row = `
                    <tr>
                        <td>${trip.id}</td>
                        <td><span class="badge bg-warning">${trip.routeId}</span></td>
                        <td>${trip.startTime}</td>
                        <td>${trip.endTime}</td>
                        <td><span class="badge bg-info">${trip.dayType}</span></td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-info" onclick="editTrip(${trip.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline-danger" onclick="deleteTrip(${trip.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function saveTrip() {
            const tripRoute = document.getElementById('tripRoute').value;
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            const dayType = document.getElementById('dayType').value;
            
            if (!tripRoute || !startTime || !endTime || !dayType) {
                showToast('Please fill in all required fields!', 'error');
                return;
            }
            
            // API call will be added here
            console.log('Saving trip:', { tripRoute, startTime, endTime, dayType });
            
            // Close modal
            bootstrap.Modal.getInstance(document.getElementById('addTripModal')).hide();
            
            // Clear form
            document.getElementById('addTripForm').reset();
            
            // Show success message
            showToast('Trip added successfully!', 'success');
        }
        
        function editTrip(id) {
            showToast('Edit trip functionality will be implemented!', 'info');
        }
        
        function deleteTrip(id) {
            if (confirm('Are you sure you want to delete this trip?')) {
                showToast('Trip deleted successfully!', 'success');
            }
        }
        
        // Route Stop Functions
        function saveRouteStop() {
            const routeStopRoute = document.getElementById('routeStopRoute').value;
            const routeStopStop = document.getElementById('routeStopStop').value;
            const stopOrder = document.getElementById('stopOrder').value;
            
            if (!routeStopRoute || !routeStopStop || !stopOrder) {
                showToast('Please fill in all required fields!', 'error');
                return;
            }
            
            // API call will be added here
            console.log('Saving route stop:', { routeStopRoute, routeStopStop, stopOrder });
            
            // Close modal
            bootstrap.Modal.getInstance(document.getElementById('addRouteStopModal')).hide();
            
            // Clear form
            document.getElementById('addRouteStopForm').reset();
            
            // Show success message
            showToast('Route stop connection added successfully!', 'success');
        }
        
        function editRouteStop(id) {
            showToast('Edit route stop functionality will be implemented!', 'info');
        }
        
        function deleteRouteStop(id) {
            if (confirm('Are you sure you want to delete this route stop connection?')) {
                showToast('Route stop connection deleted successfully!', 'success');
            }
        }
        
        // Settings Functions
        function saveSettings() {
            const theme = document.querySelector('input[name="theme"]:checked')?.value;
            const autoRefresh = document.getElementById('autoRefresh').checked;
            
            // Save settings to localStorage
            if (theme && window.setTheme) {
                window.setTheme(theme, true); // Animasyonlu tema geçişi
            }
            localStorage.setItem('autoRefresh', autoRefresh);
            
            // Close modal
            bootstrap.Modal.getInstance(document.getElementById('settingsModal')).hide();
            
            showToast('Settings saved successfully!', 'success');
        }
        
        // Toast notification function
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            const toastId = 'toast-' + Date.now();
            
            let bgClass = 'bg-primary';
            let icon = 'fas fa-info-circle';
            
            switch(type) {
                case 'success':
                    bgClass = 'bg-success';
                    icon = 'fas fa-check-circle';
                    break;
                case 'error':
                    bgClass = 'bg-danger';
                    icon = 'fas fa-exclamation-circle';
                    break;
                case 'warning':
                    bgClass = 'bg-warning';
                    icon = 'fas fa-exclamation-triangle';
                    break;
            }
            
            const toastHtml = `
                <div id="${toastId}" class="toast align-items-center text-white ${bgClass} border-0" role="alert">
                    <div class="d-flex">
                        <div class="toast-body">
                            <i class="${icon}"></i> ${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                    </div>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('beforeend', toastHtml);
            const toastElement = document.getElementById(toastId);
            const toast = new bootstrap.Toast(toastElement, { delay: 3000 });
            toast.show();
            
            // Remove toast element after it's hidden
            toastElement.addEventListener('hidden.bs.toast', function () {
                toastElement.remove();
            });
        }
        
        // Tab change handler
        document.querySelectorAll('#adminTabs button').forEach(tab => {
            tab.addEventListener('shown.bs.tab', function (e) {
                const targetTab = e.target.getAttribute('data-bs-target');
                console.log('Switched to tab:', targetTab);
                // Load specific data for the tab if needed
            });
        });
        
    </script>
}

@section Styles {
    <style>
        .card {
            transition: transform 0.2s ease-in-out;
        }
        
        .card:hover {
            transform: translateY(-2px);
        }
        
        .table th {
            border-top: none;
        }
        
        .btn-group-sm .btn {
            padding: 0.25rem 0.5rem;
        }
        
        .stats-card {
            background: linear-gradient(135deg, var(--bs-primary), var(--bs-primary-rgb));
        }
        
        .nav-tabs .nav-link {
            border: none;
            color: #6c757d;
        }
        
        .nav-tabs .nav-link.active {
            background-color: #fff;
            border-bottom: 3px solid var(--bs-primary);
            color: var(--bs-primary);
            font-weight: 600;
        }
        
        .modal-header {
            border-bottom: 1px solid rgba(0,0,0,.125);
        }
        
        .toast {
            min-width: 300px;
        }
        
        @@media (max-width: 768px) {
            .btn-group-sm {
                display: flex;
                flex-direction: column;
                gap: 2px;
            }
            
            .table-responsive {
                font-size: 0.875rem;
            }
        }
    </style>
    
    <!-- AdminPanel özel CSS dosyası -->
    <link rel="stylesheet" href="~/css/adminpanel.css" asp-append-version="true" />
}
